<!-- templates/index.html -->
{% extends "home.html" %}

{% block title %}Search{% endblock %}

{% block content %}
  <!-- Search -->
  <div class="search-box">
    <form action="{{ url_for('search') }}" method="get">
      <input type="search" name="query" id="search"
             placeholder="Search anime..."
             value="{{ query or '' }}" />
      <input type="submit" value="Submit" />
    </form>
  </div>

  <!-- Filters -->
  <div class="genres">
    <h2>Filter</h2>
    <form action="{{ url_for('search') }}" method="get">

      <h3>Main Genres</h3>
      {% set all_genres = [
        "Action", "Adventure", "Comedy", "Drama", "Ecchi", "Fantasy",
        "Horror", "Mahou Shoujo", "Mecha", "Music", "Mystery", "Psychological",
        "Romance", "Sci-Fi", "Slice of Life", "Sports", "Supernatural", "Thriller"
      ] %}

      <div class="checkbox-grid">
        {% for genre in all_genres %}
          <label>
            <input type="checkbox" name="genre" value="{{ genre }}"
              {% if genre in request.args.getlist('genre') %}checked{% endif %}>
            <span>{{ genre }}</span>
          </label>
        {% endfor %}
      </div>

      <h3>Themes</h3>
      {% set all_themes = [
        "Nudity","Cosplay","Otaku Culture","Primarily Female Cast","Primarily Male Cast",
        "Primarily Child Cast","School","Yandere","Tsundere","Unrequited Love","Male Protagonist",
        "Female Protagonist","Love Triangle","Marriage","Netorare","Magic","Demons","Angels",
        "Delinquents","Revenge","Female Harem","Detective","Shoujo","Tragedy"
      ] %}

      <div class="checkbox-grid">
        {% for theme in all_themes %}
          <label>
            <input type="checkbox" name="themes" value="{{ theme }}"
              {% if theme in request.args.getlist('themes') %}checked{% endif %}>
            <span>{{ theme }}</span>
          </label>
        {% endfor %}
      </div>

      <!-- Buttons -->
      <div class="filter-buttons">
        <button type="submit">Apply Filter</button>
        <a href="{{ url_for('search') }}" class="clear-btn">Clear</a>
      </div>
    </form>
  </div>

  <!-- Results -->
  <div class="results">
    {% if results %}
      <h3>Filter Results</h3>
      <div class="anime-grid">
        {% for anime in results %}
          <div class="anime-card">
            <a href="{{ url_for('details', mal_id=anime.api_data.mal_id) }}">
              <img src="{{ anime.api_data.image_url }}" alt="{{ anime.api_data.title_english or anime.title }}">
            </a>
            <h3>{{ anime.api_data.title_english or anime.title }}</h3>
            <p>{{ ", ".join(anime.api_data.genres or []) }}</p>
          </div>
        {% endfor %}
      </div>

    {% elif querys %}
      <h3>Search Results for "{{ query }}"</h3>
      <div class="anime-grid">
        {% for anime in querys %}
          <div class="anime-card">
            <a href="{{ url_for('details', mal_id=anime.api_data.mal_id) }}">
              <img src="{{ anime.api_data.image_url }}" alt="{{ anime.api_data.title_english or anime.title }}">
            </a>
            <h3>{{ anime.api_data.title_english or anime.title }}</h3>
            <p>{{ ", ".join(anime.api_data.genres or []) }}</p>
          </div>
        {% endfor %}
      </div>

    {% elif query %}
      <p>No results found for "{{ query }}".</p>

    {% elif request.args.getlist('genre') or request.args.getlist('themes') %}
      <p>No results found for selected filters.</p>

    {% else %}
      <p>Use the search bar or filters above to find anime.</p>
    {% endif %}
  </div>
{% endblock %}
